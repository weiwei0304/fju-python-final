# 轉身日曆 - 程式碼說明文件

## 一、專案概述

「轉身日曆」是一個基於 Streamlit 框架開發的網頁應用程式，主要功能是協助使用者計算離職相關的日期資訊，包括預告期、最早離職日期以及離職倒數天數。本專案採用模組化設計，將業務邏輯與使用者介面分離，提升程式碼的可維護性與可讀性。

---

## 二、檔案架構說明

### 2.1 主要檔案
- **main.py**：使用者介面與流程控制
- **resignation_calculator.py**：離職計算邏輯核心

---

## 三、resignation_calculator.py 詳細說明

### 3.1 類別設計
`ResignationCalculator` 是一個專門處理離職日期計算的類別，封裝了所有與離職日期相關的計算邏輯。

### 3.2 核心方法說明

#### 3.2.1 `_calculate_work_months(self, start_date)`
**功能**：計算從到職日到目前為止的工作月數

**實作邏輯**：
- 取得今天的日期
- 計算到職日與今天的天數差
- 將天數轉換為月數（以 30 天為一個月）

**用途**：作為判斷預告期長短的依據

#### 3.2.2 `_get_notice_days(self, work_months)`
**功能**：根據工作月數決定預告期天數

**預告期規則**（符合台灣勞動基準法）：
- 工作未滿 3 個月：預告期 0 天
- 工作 3 個月以上未滿 1 年：預告期 10 天
- 工作 1 年以上未滿 3 年：預告期 20 天
- 工作 3 年以上：預告期 30 天

**設計理念**：將法規邏輯封裝在獨立方法中，未來若法規變更，只需修改此處即可。

#### 3.2.3 `calculate_earliest_effective_date(self, start_date)`
**功能**：計算最早可以提出離職的日期

**實作邏輯**：
1. 首先判斷到職日是否為未來日期
   - 如果是未來日期，直接返回到職日（因為尚未開始工作，預告期為 0）
2. 如果到職日是過去或今天：
   - 計算工作月數
   - 根據工作月數取得預告期天數
   - 從今天開始加上預告期天數，即為最早可離職日

**應用場景**：當使用者選擇「沒有確定離職日期」時，系統會顯示最早可以提出離職的時間。

#### 3.2.4 `_calculate_work_months_until_quit(self, start_date, quit_date)`
**功能**：計算從到職日到離職日之間的工作月數

**實作邏輯**：
- 計算到職日與離職日之間的天數差
- 將天數轉換為月數

**用途**：用於計算在離職時需要遵守的預告期長度。

#### 3.2.5 `calculate_resignation_details(self, start_date, quit_date)`
**功能**：計算完整的離職資訊

**回傳資訊**：
- `quit_date`：離職日期
- `notice_date`：需要提出離職預告的日期（離職日往前推算預告期）
- `notice_days`：預告期天數
- `today`：今天日期
- `countdown`：距離離職日的倒數天數

**應用場景**：當使用者有確定離職日期時，系統會顯示完整的離職資訊，包括何時需要提出離職預告。

---

## 四、main.py 詳細說明

### 4.1 整體架構
`main.py` 負責建構使用者介面、處理使用者互動，並呼叫計算邏輯來產生結果。

### 4.2 使用者介面設計（CSS 樣式）

#### 4.2.1 動畫效果
系統定義了三種 CSS 動畫：
- **fadeIn**：淡入效果，用於頁面載入時的元素淡入
- **slideUp**：從下往上滑入效果，用於卡片和訊息框的出現
- **pulse**：脈衝效果（預留，可擴充使用）

#### 4.2.2 視覺設計
- **背景**：使用漸層背景（米色系），營造溫暖舒適的視覺感受
- **卡片設計**：白色圓角卡片，搭配金色頂部裝飾條，提升視覺層次
- **色彩系統**：
  - 主色調：棕色系（#5d4e37, #8b6f47）
  - 成功訊息：綠色系（#6b9f78）
  - 錯誤訊息：紅色系（#d67b7b）
  - 資訊訊息：藍色系（#6b9fcf）

#### 4.2.3 互動效果
- **懸停效果**：卡片和按鈕在滑鼠移過時會有輕微上升效果
- **按鈕回饋**：按鈕點擊時有視覺回饋
- **響應式設計**：針對 640px 以下的小螢幕進行優化，確保行動裝置的良好體驗

### 4.3 應用程式流程

#### 4.3.1 狀態管理
使用 Streamlit 的 `session_state` 來管理應用程式狀態：
- `step`：記錄目前所在的步驟（1 或 2）
- `start_date`：使用者選擇的到職日
- `has_quit_date`：使用者是否確定離職日期
- `quit_date`：使用者選擇的離職日

#### 4.3.2 步驟一：選擇到職日
**流程說明**：
1. 顯示標題「轉身日曆」和標語「把自己還給自己」
2. 提供日期選擇器讓使用者選擇到職日
3. 當使用者選擇日期後，自動將狀態切換到步驟二

**技術實作**：
- 使用 `st.date_input()` 建立日期選擇器
- 使用 `st.container()` 包裝內容，配合 CSS 建立卡片效果
- 使用 `st.rerun()` 重新執行應用程式以更新畫面

#### 4.3.3 步驟二：選擇是否有確定離職日期
**流程說明**：
1. 顯示標語「把自己還給自己」
2. 提供單選按鈕讓使用者選擇「是」或「否」
3. 根據選擇進入不同的分支流程

**分支一：選擇「否」（沒有確定離職日期）**
- 呼叫 `calculate_earliest_effective_date()` 計算最早可離職日
- 判斷到職日是否為未來日期：
  - 如果是未來日期：顯示藍色資訊訊息，說明到職後即可提出離職
  - 如果是過去日期：顯示綠色成功訊息，顯示最早可離職日期
- 提供「上一步」按鈕，讓使用者可以返回修改

**分支二：選擇「是」（有確定離職日期）**
- 提供日期選擇器讓使用者選擇離職日
- 當使用者選擇離職日後：
  - 呼叫 `calculate_resignation_details()` 計算完整離職資訊
  - 判斷倒數天數：
    - 如果倒數天數 > 0：顯示完整的離職資訊（到職日、離職日、預告天數、倒數天數）
      - 倒數 ≤ 30 天：播放氣球慶祝特效 🎈
      - 倒數 31-60 天：播放雪花特效 ❄️
    - 如果倒數天數 ≤ 0：顯示錯誤訊息，提示日期已過期
  - 提供「上一步」按鈕

### 4.4 使用者體驗優化

#### 4.4.1 視覺回饋
- 所有訊息框都有滑入動畫效果
- 成功訊息使用綠色系，錯誤訊息使用紅色系，資訊訊息使用藍色系
- 按鈕有懸停和點擊的視覺回饋

#### 4.4.2 慶祝特效
- 當離職倒數 ≤ 30 天時，播放氣球特效，增加使用者的期待感
- 當離職倒數 31-60 天時，播放雪花特效，給予適度的鼓勵

#### 4.4.3 錯誤處理
- 檢查離職日期是否已過期，避免顯示無意義的負數倒數
- 提供清楚的錯誤訊息引導使用者重新選擇

---

## 五、技術特色

### 5.1 模組化設計
- 將計算邏輯與介面邏輯分離，提升程式碼的可維護性
- `ResignationCalculator` 類別可以獨立測試和重用

### 5.2 使用者體驗
- 採用漸進式表單設計，引導使用者逐步完成操作
- 使用 CSS 動畫和特效，提升視覺吸引力
- 響應式設計，支援各種裝置

### 5.3 法規遵循
- 預告期計算完全符合台灣勞動基準法規定
- 處理未來到職日期的邊界情況

### 5.4 程式碼品質
- 使用有意義的變數和方法名稱
- 適當的註解說明
- 清晰的程式碼結構

---

## 六、未來擴充建議

1. **資料持久化**：可考慮將使用者的離職資訊儲存到資料庫
2. **提醒功能**：可加入提醒功能，在預告期前通知使用者
3. **多語言支援**：可擴充支援其他語言
4. **匯出功能**：可將離職資訊匯出為 PDF 或 Excel
5. **歷史記錄**：記錄使用者的查詢歷史

---

## 七、總結

「轉身日曆」是一個結合實用性與美觀性的網頁應用程式，透過清晰的流程設計、優雅的視覺呈現，以及準確的計算邏輯，協助使用者輕鬆掌握離職相關的重要日期資訊。程式碼採用模組化設計，不僅易於維護，也為未來的功能擴充奠定了良好的基礎。


